{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- meta block -->
    {% block meta %} {% endblock meta %}
    <!-- style sheets -->
    {% block stylesheets %}
    <!-- One file includes all the Font Awesome Free icons and utilities -->
    <link href="{% static 'fontawesomefree/css/all.min.css' %}" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="{% static 'assets/css/styles.css' %}" />
    {% endblock stylesheets %}
    <!-- One file includes all the Font Awesome Free icons and utilities -->
    <script src="{% static 'fontawesomefree/js/all.min.js' %}"></script>
    <!-- title block -->
    {% block title %} {% endblock title %}
  </head>
  <body {% if not 'project' in request.path %} data-full-page="true" {% endif%}>
    <!-- navbar -->
    {% include 'snippets/_navbar_snippet.html' %}
    <!-- page content block -->
    {% block content %} {% endblock content %}

    <!-- footer -->
    {% include 'snippets/_footer_snippet.html' %}
    <!-- scripts -->
    {% block scripts %}
      <script src="{% static 'assets/js/htmx.min.js' %}"></script>
      <script src="{% static 'assets/js/main.js' %}"></script>
      <script>
        document.addEventListener("DOMContentLoaded", function() {
            checkConsentAndFetchMessage();
        });

        function checkConsentAndFetchMessage() {
          var consentGivenCookie = getCookie("consent_given");
          var consentRejectedCookie = getCookie("consent_rejected");
          
          if (!consentGivenCookie && !consentRejectedCookie) {
              fetchConsentMessage();
          } else {
              removeConsentPopup();
          }
        }

        function fetchConsentMessage() {
            var container = document.getElementById("consent-message-popup");
            var url = container.getAttribute("data-url");
            // issue a GET to url and replace #consent-message-popup with the response
            htmx.ajax('GET', url, {target:'#consent-message-popup', swap:'outerHTML'})
        }

        function giveConsent() {
          // Set a cookie named 'consent_given' with an expiry date
          var expiryDate = new Date();
          expiryDate.setFullYear(expiryDate.getFullYear() + 1); // Expiry date set to one year from now
          document.cookie = "consent_given=true; expires=" + expiryDate.toUTCString() + "; path=/";

          removeConsentPopup()
        }
        
        function rejectConsent() {
          // Set a session cookie
          document.cookie = "consent_rejected=true";
          removeConsentPopup()
        }
        
        function removeConsentPopup() {
          // Remove the consent popup from the DOM
          var consentPopup = document.getElementById("consent-message-popup");
          consentPopup.parentNode.removeChild(consentPopup);
        }

        function getCookie(cookieName) {
            var name = cookieName + "=";
            var decodedCookie = decodeURIComponent(document.cookie);
            var cookieArray = decodedCookie.split(';');
            for (var i = 0; i < cookieArray.length; i++) {
                var cookie = cookieArray[i];
                while (cookie.charAt(0) == ' ') {
                    cookie = cookie.substring(1);
                }
                if (cookie.indexOf(name) == 0) {
                    return true; // Cookie exists
                }
            }
            return false; // Cookie does not exist
        }
      </script>
    {% endblock scripts %}
  </body>
</html>
